!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("fs"),require("glob"),require("path"),require("chalk"),require("@babel/core"),require("@angular/localize"),require("@babel/types"),require("yargs"),require("find-up")):"function"==typeof define&&define.amd?define("@locl/cli",["exports","@angular/core","fs","glob","path","chalk","@babel/core","@angular/localize","@babel/types","yargs","find-up"],t):t(((e=e||self).locl=e.locl||{},e.locl.cli={}),e.ng.core,e.fs,e.glob,e.path,e.chalk,e.core$1,e.ng.localize,e.types,e.yargs,e.findUp)}(this,(function(e,t,n,r,s,a,i,o,c,u,l){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var p=function(e,t){return(p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function d(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}var g=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{imports:[],declarations:[],exports:[]}]}],e}(),f=function(){function e(){this.messages=[]}return Object.defineProperty(e.prototype,"hasErrors",{get:function(){return this.messages.some((function(e){return"error"===e.type}))},enumerable:!0,configurable:!0}),e.prototype.log=function(e){this.messages.push({type:"",message:e})},e.prototype.warn=function(e){this.messages.push({type:"warning",message:e})},e.prototype.error=function(e){this.messages.push({type:"error",message:e})},e.prototype.formatDiagnostics=function(e){var t=this.messages.filter((function(e){return"error"===e.type})).map((function(e){return" - "+e.message})),n=this.messages.filter((function(e){return"warning"===e.type})).map((function(e){return" - "+e.message}));return t.length&&(e+="\nERRORS:\n"+t.join("\n")),n.length&&(e+="\nWARNINGS:\n"+n.join("\n")),e},e.prototype.logMessages=function(){for(;this.messages.length;){var e=this.messages.shift();switch(e.type){case"warning":console.warn(a.yellow("Warning: "+e.message));break;case"error":console.error(a.red("Error: "+e.message));break;default:console.log(a.blue(""+e.message))}}},e}();var h=function(){function e(){}return e.readFile=function(e){return n.readFileSync(e,"utf8")},e.readFileBuffer=function(e){return n.readFileSync(e)},e.writeFile=function(t,r){e.ensureDir(s.dirname(t)),n.writeFileSync(t,r)},e.ensureDir=function(t){for(var r=[];!e.isRoot(t)&&!n.existsSync(t);)r.push(t),t=s.dirname(t);for(;r.length;)n.mkdirSync(r.pop())},e.remove=function(t){var r=n.statSync(t);r.isFile()?n.unlinkSync(t):r.isDirectory()&&(n.readdirSync(t).forEach((function(n){var r=s.resolve(t,n);e.remove(r)})),n.rmdirSync(t))},e.isRoot=function(e){return s.dirname(e)===e},e.dedup=function(e,t,n){void 0===n&&(n="");var r=e.map((function(e){return e.replace(t,n)})),s=[],a=[];return r.forEach((function(e,t){-1===s.indexOf(e)&&(s.push(e),a.push(t))})),a.map((function(t){return e[t]}))},e}();var m=function(){function e(){}return e.prototype.renderFile=function(e,t){var n={locale:t,translations:{}};return e.forEach((function(e){n.translations[e.id||e.messageId]=e.text||e.messageString})),JSON.stringify(n,null,2)},e}();
/**
     * @license
     * Copyright Google Inc. All Rights Reserved.
     *
     * Use of this source code is governed by an MIT-style license that can be
     * found in the LICENSE file at https://angular.io/license
     */var v=function(){function e(){this.output="",this.indent="",this.elements=[],this.preservingWhitespace=!1}return e.prototype.toString=function(){return this.output},e.prototype.startTag=function(e,t,n){var r=this;void 0===t&&(t={});var s=void 0===n?{}:n,a=s.selfClosing,i=void 0!==a&&a,o=s.preserveWhitespace;return this.preservingWhitespace||(this.output+=this.indent),this.output+="<"+e,Object.keys(t).forEach((function(e){t[e]&&(r.output+=" "+e+'="'+x(t[e])+'"')})),i?this.output+="/>":(this.output+=">",this.elements.push(e),this.incIndent()),void 0!==o&&(this.preservingWhitespace=o),this.preservingWhitespace||(this.output+="\n"),this},e.prototype.endTag=function(e,t){var n=(void 0===t?{}:t).preserveWhitespace,r=this.elements.pop();if(r!==e)throw new Error('Unexpected closing tag: "'+e+'", expected: "'+r+'"');return this.decIndent(),this.preservingWhitespace||(this.output+=this.indent),this.output+="</"+e+">",void 0!==n&&(this.preservingWhitespace=n),this.preservingWhitespace||(this.output+="\n"),this},e.prototype.text=function(e){return this.output+=x(e),this},e.prototype.startPreserveWhitespace=function(){this.preservingWhitespace=!0},e.prototype.stopPreserveWhitespace=function(){this.preservingWhitespace=!1},e.prototype.incIndent=function(){this.indent=this.indent+"  "},e.prototype.decIndent=function(){this.indent=this.indent.slice(0,-2)},e}();var y=[[/&/g,"&amp;"],[/"/g,"&quot;"],[/'/g,"&apos;"],[/</g,"&lt;"],[/>/g,"&gt;"]];function x(e){return y.reduce((function(e,t){return e.replace(t[0],t[1])}),e)}var T=function(){function e(){}return e.prototype.renderFile=function(e,t,n){var r,s=this;void 0===n&&(n=!1);var a=new v;a.startTag("xliff",{version:"1.2",xmlns:"urn:oasis:names:tc:xliff:document:1.2"});var i=((r={})["source-language"]=n?void 0:t,r["target-language"]=t,r.datatype="plaintext",r);return a.startTag("file",i),a.startTag("body"),e.forEach((function(e){a.startTag("trans-unit",{id:e.id||e.messageId,datatype:"html"}),n||s.generateMessageTag(a,"source",e),s.generateMessageTag(a,"target",e),e.description&&s.renderNote(a,"description",e.description),e.meaning&&s.renderNote(a,"meaning",e.meaning),a.endTag("trans-unit")})),a.endTag("body"),a.endTag("file"),a.endTag("xliff"),a.toString()},e.prototype.generateMessageTag=function(e,t,n){e.startTag(t,{},{preserveWhitespace:!0}),this.renderMessage(e,n),e.endTag(t,{preserveWhitespace:!1})},e.prototype.renderMessage=function(e,t){e.text(t.messageParts[0]);for(var n=1;n<t.messageParts.length;n++)e.startTag("x",{id:t.placeholderNames[n-1]},{selfClosing:!0}),e.text(t.messageParts[n])},e.prototype.renderNote=function(e,t,n){e.startTag("note",{priority:"1",from:t},{preserveWhitespace:!0}),e.text(n),e.endTag("note",{preserveWhitespace:!1})},e}(),w=function(){function e(){}return e.prototype.renderFile=function(e,t,n){var r=this;void 0===n&&(n=!1);var s=new v;return s.startTag("xliff",{version:"2.0",xmlns:"urn:oasis:names:tc:xliff:document:2.0",srcLang:t,trgLang:t}),s.startTag("file"),e.forEach((function(e){s.startTag("unit",{id:e.id||e.messageId}),(e.meaning||e.description)&&(s.startTag("notes"),e.description&&r.renderNote(s,"description",e.description),e.meaning&&r.renderNote(s,"meaning",e.meaning),s.endTag("notes")),s.startTag("segment"),n||r.generateMessageTag(s,"source",e),r.generateMessageTag(s,"target",e),s.endTag("segment"),s.endTag("unit")})),s.endTag("file"),s.endTag("xliff"),s.toString()},e.prototype.generateMessageTag=function(e,t,n){e.startTag(t,{},{preserveWhitespace:!0}),this.renderMessage(e,n),e.endTag(t,{preserveWhitespace:!1})},e.prototype.renderMessage=function(e,t){e.text(t.messageParts[0]);for(var n=1;n<t.messageParts.length;n++){var r=t.placeholderNames[n-1];r.startsWith("START_")?e.startTag("pc",{id:""+n,equivStart:r,equivEnd:r.replace(/^START/,"CLOSE")}):r.startsWith("CLOSE_")?e.endTag("pc"):e.startTag("ph",{id:""+n,equiv:r},{selfClosing:!0}),e.text(t.messageParts[n])}},e.prototype.renderNote=function(e,t,n){e.startTag("note",{category:t},{preserveWhitespace:!0}),e.text(n),e.endTag("note",{preserveWhitespace:!1})},e}(),b=function(){function e(){}return e.prototype.renderFile=function(e){var t=this,n=new v;return n.startTag("messagebundle"),e.forEach((function(e){n.startTag("msg",{id:e.id||e.messageId,desc:e.description,meaning:e.meaning},{preserveWhitespace:!0}),t.renderMessage(n,e),n.endTag("msg",{preserveWhitespace:!1})})),n.endTag("messagebundle"),n.toString()},e.prototype.renderMessage=function(e,t){e.text(t.messageParts[0]);for(var n=1;n<t.messageParts.length;n++)e.startTag("ph",{name:t.placeholderNames[n-1]},{selfClosing:!0}),e.text(t.messageParts[n])},e}(),E=function(){function e(){}return e.prototype.renderFile=function(e,t){var n=this,r=new v;return r.startTag("translationbundle",{lang:t}),e.forEach((function(e){r.startTag("translation",{id:e.id||e.messageId,desc:e.description,meaning:e.meaning},{preserveWhitespace:!0}),n.renderMessage(r,e),r.endTag("translation",{preserveWhitespace:!1})})),r.endTag("translationbundle"),'<?xml version="1.0" encoding="UTF-8"?>\n<!DOCTYPE translationbundle [\n<!ELEMENT translationbundle (translation)*>\n<!ATTLIST translationbundle lang CDATA #REQUIRED>\n\n<!ELEMENT translation (#PCDATA|ph)*>\n<!ATTLIST translation id CDATA #REQUIRED>\n<!ATTLIST translation desc CDATA #IMPLIED>\n<!ATTLIST translation meaning CDATA #IMPLIED>\n<!ATTLIST translation xml:space (default|preserve) "default">\n\n<!ELEMENT ph (#PCDATA|ex)*>\n<!ATTLIST ph name CDATA #REQUIRED>\n\n<!ELEMENT ex (#PCDATA)>\n]>\n'+r.toString()},e.prototype.renderMessage=function(e,t){e.text(t.messageParts[0]);for(var n=1;n<t.messageParts.length;n++)e.startTag("ph",{name:t.placeholderNames[n-1]},{selfClosing:!0}),e.text(t.messageParts[n])},e}();function S(e,t){return e.isIdentifier()&&e.node.name===t}function I(e){return!e.scope||!e.scope.hasBinding(e.node.name)}function M(e){var t=e.get("arguments")[0];if(void 0===t)throw new W(e.node,"`$localize` called without any arguments.");if(!t.isExpression())throw new W(t.node,"Unexpected argument to `$localize` (expected an array).");var n=t;if(t.isLogicalExpression()&&"||"===t.node.operator&&t.get("left").isIdentifier()){var r=t.get("right");if(r.isAssignmentExpression()&&!(t=r.get("right")).isExpression())throw new W(t.node,'Unexpected "makeTemplateObject()" function (expected an expression).')}if(t.isCallExpression()){var s=t;if(0===s.get("arguments").length&&(s=function(e){var t=e.get("callee");if(!t.isIdentifier())throw new W(t.node,"Unexpected lazy-load helper call (expected a call of the form `_templateObject()`).");var n=e.scope.getBinding(t.node.name);if(!n)throw new W(t.node,"Missing declaration for lazy-load helper function");var r=n.path;if(!r.isFunctionDeclaration())throw new W(r.node,"Unexpected expression (expected a function declaration");var s=function(e){var t,n,r=e.get("body").get("body");try{for(var s=d(r),a=s.next();!a.done;a=s.next()){var i=a.value;if(i.isReturnStatement()){var o=i.get("argument");if(o.isSequenceExpression()){var c=o.get("expressions");return Array.isArray(c)?c[c.length-1]:c}if(o.isExpression())return o;throw new W(i.node,"Invalid return argument in helper function (expected an expression).")}}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}throw new W(e.node,"Missing return statement in helper function.")}(r);if(s.isCallExpression())return s;if(s.isIdentifier()){var a=s.node.name,i=s.scope.getBinding(a);if(void 0===i)throw new W(s.node,"Missing declaration for return value from helper.");if(!i.path.isVariableDeclarator())throw new W(i.path.node,"Unexpected helper return value declaration (expected a variable declaration).");var o=i.path.get("init");if(!o.isCallExpression())throw new W(i.path.node,"Unexpected return value from helper (expected a call expression).");return 1===n.references&&r.remove(),o}return e}(s)),!(t=s.get("arguments")[0]).isExpression())throw new W(t.node,'Unexpected `cooked` argument to the "makeTemplateObject()" function (expected an expression).');var a=s.get("arguments")[1];if(a&&!a.isExpression())throw new W(a.node,'Unexpected `raw` argument to the "makeTemplateObject()" function (expected an expression).');n=void 0!==a?a:t}var i=P(t.node),c=P(n.node);return o.ɵmakeTemplateObject(i,c)}function A(e){var t=e.arguments.splice(1);if(!t.every((function(e){return c.isExpression(e)}))){var n=t.find((function(e){return!c.isExpression(e)}));throw new W(n,"Invalid substitutions for `$localize` (expected all substitution arguments to be expressions).")}return t}function P(e){if(t=e,!c.isArrayExpression(t)||!t.elements.every((function(e){return c.isStringLiteral(e)})))throw new W(e,"Unexpected messageParts for `$localize` (expected an array of strings).");var t;return e.elements.map((function(e){return e.value}))}var W=function(e){function t(t,n){var r=e.call(this,n)||this;return r.node=t,r.type="BabelParseError",r}return function(e,t){function n(){this.constructor=e}p(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(t,e),t}(Error);function j(e,t,n){return void 0===n&&(n="$localize"),{visitor:{TaggedTemplateExpression:function(t){var r,s,a,i=t.get("tag");if(S(i,n)&&I(i)){var c=(r=t.node.quasi.quasis,s=r.map((function(e){if(void 0===e.value.cooked)throw new W(e,'Unexpected undefined message part in "'+r.map((function(e){return e.value.cooked}))+'"');return e.value.cooked})),a=r.map((function(e){return e.value.raw})),o.ɵmakeTemplateObject(s,a)),u=o.ɵparseMessage(c,t.node.quasi.expressions);e.find((function(e){return u.id?e.id===u.id:e.messageId===u.messageId}))||e.push(u)}}}}}var q=function(){function e(e){this.diagnostics=e,this.messages=[]}return e.prototype.extractMessages=function(e){var t,n;e.includes("$localize")&&i.transformSync(e,{plugins:[j(this.messages,this.diagnostics),(t=this.messages,this.diagnostics,void 0===n&&(n="$localize"),{visitor:{CallExpression:function(e){var r=e.get("callee");if(S(r,n)&&I(r)){var s=M(e),a=A(e.node),i=o.ɵparseMessage(s,a);t.find((function(e){return i.id?e.id===i.id:e.messageId===i.messageId}))||t.push(i)}}}})],code:!1,ast:!1})},e}();function C(e){var t=e.sourceGlob,a=e.format,i=e.outputPath,o=e.locales,c=void 0===o?["en"]:o,u=e.diagnostics;console.log('Extracting translations from "'+t+'"');var l=r.sync(s.resolve(t),{absolute:!0,nodir:!0});l=h.dedup(l,/\-es(5|2015)\./,"."),i=s.resolve(i);var p,d=[];try{p=n.statSync(i).isFile()}catch(e){p=!!s.extname(i)}if(p){if(c.length>1)return void u.error('Multiple locales detected ("'+c.join(",")+'") but output "'+i+'" is not a directory');var g=D(l,s.posix.normalize(i),t,a,c[0],u);g&&d.push(g)}else l.forEach((function(e){c.forEach((function(n){var r=s.posix.join(i,s.basename(e,".js").replace(/-es(5|2015)/,"")+"."+n+"."+function(e){switch(e){case"json":case"xmb":case"xtb":return e;default:return"xlf"}}(a)),o=D([e],r,t,a,n,u);o&&d.push(o)}))}));d.length||u.error("No messages found. You should build the angular app without a language target for this command to work.")}function D(e,t,r,s,a,i){var o=new q(i);e.forEach((function(e){var t=n.readFileSync(e,"utf8");o.extractMessages(t)}));var c=function(e){switch(e){case"json":return new m;case"xliff1":case"xlf":return new T;case"xliff2":case"xlf2":return new w;case"xmb":return new b;case"xtb":return new E}}(s);if(o.messages.length>0){var u=c.renderFile(o.messages,a,!1);return h.writeFile(t,u),console.log('  Generated file "'+t+'"'),t}return null}var k=l.sync([".loclrc",".locl.json"]),N=k?JSON.parse(n.readFileSync(k,{encoding:"utf8"})):{},O=process.argv.slice(2);u.config(N).commandDir("cmds").demandCommand().help().version(!1).parse(O),e.CliModule=g,e.builder={s:{alias:"source",required:!0,describe:"A glob pattern indicating what files to search for translations, e.g. `./dist/**/*.js`. This can be absolute or relative to the current working directory."},f:{alias:"format",required:!0,describe:"The format of the translation files to generate.",choices:["json","xlf","xmb","xlf2"],default:"json"},o:{alias:"outputPath",required:!0,describe:"A path to where the translation file will be written. This can be absolute or relative to the current working directory."},l:{alias:["locale","locales"],required:!1,type:"array",describe:'The locale for the extracted file, "en" by default. If you use multiple locales (e.g. "en fr es"), a new file will be generated for each locale'}},e.command="extract",e.describe="Extract translations from your ivy application",e.extractTranslations=C,e.handler=function(e){var t=new f;C({sourceGlob:e.s,format:e.f,outputPath:e.o,locales:e.l,diagnostics:t}),t.logMessages(),process.exit(t.hasErrors?1:0)},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=locl-cli.umd.min.js.map