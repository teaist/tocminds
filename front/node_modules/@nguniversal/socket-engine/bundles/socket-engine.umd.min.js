!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("tslib"),require("fs"),require("@angular/compiler"),require("@angular/core"),require("@angular/platform-server"),require("net")):"function"==typeof define&&define.amd?define("@nguniversal/socket-engine",["exports","tslib","fs","@angular/compiler","@angular/core","@angular/platform-server","net"],r):r(((e=e||self).nguniversal=e.nguniversal||{},e.nguniversal.socketEngine={}),e.tslib,e.fs,e.ng.compiler,e.ng.core,e.ng.platformServer,e.net)}(this,(function(e,r,t,n,i,o,a){"use strict";var s=function(){function e(){}return e.prototype.get=function(e){return new Promise((function(r,n){t.readFile(e,(function(e,t){if(e)return n(e);r(t.toString())}))}))},e}(),u=function(){function e(e,r){void 0===r&&(r=[]),this.moduleOrFactory=e,this.providers=r,this.factoryCacheMap=new Map,this.templateCache={}}return e.prototype.getCompiler=function(){return o.platformDynamicServer().injector.get(i.CompilerFactory).createCompiler([{providers:[{provide:n.ResourceLoader,useClass:s,deps:[]}]}])},e.prototype.render=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,i;return r.__generator(this,(function(a){switch(a.label){case 0:return(t=e.document)?[3,2]:[4,this.getDocument(e.documentFilePath)];case 1:t=a.sent(),a.label=2;case 2:return n=r.__spread(e.providers||[],this.providers||[],[{provide:o.INITIAL_CONFIG,useValue:{document:t,url:e.url}}]),[4,this.getFactory(this.moduleOrFactory||e.bootstrap)];case 3:return i=a.sent(),[2,o.renderModuleFactory(i,{extraProviders:n})]}}))}))},e.prototype.getFactory=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n;return r.__generator(this,(function(r){switch(r.label){case 0:return e instanceof i.NgModuleFactory?[2,e]:[3,1];case 1:return(t=this.factoryCacheMap.get(e))?[2,t]:[4,this.getCompiler().compileModuleAsync(e)];case 2:return n=r.sent(),this.factoryCacheMap.set(e,n),[2,n]}}))}))},e.prototype.getDocument=function(e){var r=this.templateCache[e]=this.templateCache[e]||t.readFileSync(e).toString();return Promise.resolve(r)},e}();
/**
     * @license
     * Copyright Google LLC All Rights Reserved.
     *
     * Use of this source code is governed by an MIT-style license that can be
     * found in the LICENSE file at https://angular.io/license
     */
/**
     * @license
     * Copyright Google LLC All Rights Reserved.
     *
     * Use of this source code is governed by an MIT-style license that can be
     * found in the LICENSE file at https://angular.io/license
     */
e.startSocketEngine=
/**
     * @license
     * Copyright Google LLC All Rights Reserved.
     *
     * Use of this source code is governed by an MIT-style license that can be
     * found in the LICENSE file at https://angular.io/license
     */
/**
     * @license
     * Copyright Google LLC All Rights Reserved.
     *
     * Use of this source code is governed by an MIT-style license that can be
     * found in the LICENSE file at https://angular.io/license
     */
/**
     * @license
     * Copyright Google LLC All Rights Reserved.
     *
     * Use of this source code is governed by an MIT-style license that can be
     * found in the LICENSE file at https://angular.io/license
     */
function c(e,t,n,i){var o=this;return void 0===t&&(t=[]),void 0===n&&(n="localhost"),void 0===i&&(i=9090),new Promise((function(s,c){var l=new u(e,t),f=a.createServer((function(e){e.on("data",(function(t){return r.__awaiter(o,void 0,void 0,(function(){var n,i,o,a;return r.__generator(this,(function(r){switch(r.label){case 0:n=t.toString(),i=JSON.parse(n),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,l.render(i)];case 2:return o=r.sent(),e.write(JSON.stringify({html:o,id:i.id})),[3,4];case 3:return a=r.sent(),e.write(JSON.stringify({html:null,id:i.id,error:a.toString()})),[3,4];case 4:return[2]}}))}))}))}));f.listen(i,n),s({close:function(){return f.close()}})}))},Object.defineProperty(e,"__esModule",{value:!0})}));